<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTENT ENGINE ‚Ä¢ TRIPLE MODE</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- CSS Utama -->
    <link rel="stylesheet" href="css/style-utama.css">
    <!-- CSS Mode akan dimuat via JS -->
    <link rel="stylesheet" href="css/style-fakta.css" id="mode-css">
    
    <style>
        /* Fallback styling kalau CSS gagal load */
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; padding: 20px; background: #f3f4f6; }
        .loading-error { text-align: center; padding: 50px; color: #ef4444; }
    </style>
</head>
<body>
    <div class="device-info" id="deviceInfo" style="display: none;">
        <span>üñ•Ô∏è Device:</span>
        <span class="device-id" id="deviceId"></span>
    </div>

    <!-- Modal Access Key -->
    <div id="accessKeyModal" class="modal-overlay">
        <div class="modal-content">
            <h2>üîë Masukkan Access Key</h2>
            <p>Silakan masukkan access key Anda.</p>
            <input type="text" id="accessKeyInput" class="modal-input" placeholder="Enter Key" autocomplete="off">
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="validateAccessKey()">MASUK</button>
            </div>
            <div id="errorMessage" class="error-message">
                <i>‚ö†Ô∏è</i> <span id="errorText"></span>
            </div>
            <div class="key-format-info">
                <p>Hubungi admin @nafassamping</p>
            </div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1>‚ö°CONTENT ENGINE ‚Ä¢ TRIPLE MODE‚ö°</h1>
            <div class="sub">PILIH MODE KONTEN ANDA</div>
        </div>

        <!-- MODE TOGGLE BUTTONS - 3 MODE -->
        <div class="mode-toggle">
            <button class="mode-btn mode-fakta active" id="modeFaktaBtn" onclick="switchMode('fakta')">
                üåç FAKTA UNIK RANDOM
            </button>
            <button class="mode-btn mode-skeleton" id="modeSkeletonBtn" onclick="switchMode('skeleton')">
                üíÄ MANUSIA TENGKORAK
            </button>
            <button class="mode-btn mode-islami" id="modeIslamiBtn" onclick="switchMode('islami')">
                üïå KISAH ISLAMI
            </button>
        </div>
        <div class="mode-indicator" id="modeIndicator">üåç Mode: Fakta Unik Random</div>
        
        <!-- STATISTICS -->
        <div class="stats-grid">
            <div class="stat-card stat-total"><div class="stat-label">Total Jobs</div><div class="stat-value" id="stat-total">0</div></div>
            <div class="stat-card stat-comp"><div class="stat-label">Generated</div><div class="stat-value" id="stat-gen">0</div></div>
            <div class="stat-card stat-succ"><div class="stat-label">Success</div><div class="stat-value" id="stat-succ">0</div></div>
            <div class="stat-card stat-fail"><div class="stat-label">Failed</div><div class="stat-value" id="stat-fail">0</div></div>
        </div>

        <textarea id="hiddenCopyArea" class="hidden-textarea" readonly></textarea>
        
        <!-- API SECTION dengan TOGGLE ON/OFF -->
        <div class="api-mini">
            <div class="api-row">
                <input type="password" id="groqKey" class="api-input" placeholder="GROQ API Key" autocomplete="off">
                <button class="api-btn" onclick="saveGroq()">SAVE</button>
            </div>
            <div class="api-row">
                <input type="password" id="elevenKey" class="api-input" placeholder="ElevenLabs Key">
                <button class="api-btn eleven" onclick="saveEleven()">SAVE</button>
            </div>
            
            <!-- Toggle Switch ElevenLabs -->
            <div class="toggle-container">
                <div class="toggle-item">
                    <span class="toggle-label">üîä Generate Voice</span>
                    <label class="switch">
                        <input type="checkbox" id="elevenToggle" checked onchange="toggleEleven()">
                        <span class="slider round"></span>
                    </label>
                    <span class="toggle-status" id="elevenToggleStatus">ON</span>
                </div>
                <div class="toggle-info" id="elevenToggleInfo">
                    <span>üéôÔ∏è Voice akan digenerate</span>
                </div>
            </div>
            
            <div class="status-mini">
                <div class="status-item"><span class="status-dot" id="groqDot"></span><span id="groqStatus">STATUS: OFF</span></div>
                <div class="status-item"><span class="status-dot" id="elevenDot"></span><span id="elevenStatus">STATUS: OFF</span></div>
            </div>
        </div>
        
        <!-- GENERATE BUTTON -->
        <button class="btn-gen" id="genBtn" onclick="generateContent()" disabled>üåç GENERATE FAKTA UNIK</button>
        
        <!-- LOADING -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div id="loadText" style="font-weight: 600; color: var(--primary);">Processing...</div>
        </div>
        
        <!-- ERROR BOX -->
        <div id="errorBox"></div>

        <!-- OUTPUT AREA -->
        <div id="outputArea" style="display:none;">
            <div id="judulCard" class="card">
                <div class="card-header">
                    <span class="card-title">üî• Viral Title</span>
                    <button class="api-btn" onclick="copyJudul()" style="padding: 6px 12px; font-size: 10px;">Copy</button>
                </div>
                <div class="judul-text" id="judulText"></div>
            </div>
            
            <div id="naskahCard" class="card">
                <div class="card-header">
                    <span class="card-title">üìù Full Script</span>
                    <button class="api-btn" onclick="copyNaskah()" style="padding: 6px 12px; font-size: 10px;">Copy</button>
                </div>
                <div class="naskah-utama" id="naskahUtama"></div>
            </div>

            <div id="audioBox" class="audio-mini"></div>
            
            <div id="sceneInfo" class="scene-info"></div>
            
            <!-- COPY ALL BUTTONS - TTI & ITV -->
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <button class="copy-prompts-btn" onclick="copyAllTTI()" id="copyAllTTIBtn" style="background: #3b82f6; flex: 1; display: none;">
                    <span>üñºÔ∏è</span> COPY ALL TTI
                </button>
                <button class="copy-prompts-btn" onclick="copyAllITV()" id="copyAllITVBtn" style="background: #10b981; flex: 1; display: none;">
                    <span>üé¨</span> COPY ALL ITV
                </button>
            </div>
            <button class="copy-prompts-btn" onclick="copyAllPrompts()" id="copyPromptsBtn" style="display: none;">
                <span>üìã</span> COPY ALL PROMPTS (GABUNGAN)
            </button>
            <div id="promptsPreview" class="prompts-preview" style="display: none;"></div>
            
            <div id="sceneGrid" class="scene-grid"></div>
            
            <div id="copyBox" class="copy-mini">
                <button class="btn-gen" style="background: #111827;" onclick="copyAll()">üìã COPY ALL DATA</button>
            </div>
        </div>
    </div>
    
    <div id="notif" class="notification">‚úÖ Copied!</div>

    <!-- JavaScript Modules -->
    <script src="js/fungsi-utama.js"></script>
    <script src="js/mode-fakta.js"></script>
    <script src="js/mode-skeleton.js"></script>
    <script src="js/mode-islami.js"></script>
    
    <script>
        // Error handling global
        window.onerror = function(msg, url, line, col, error) {
            console.error("Global error:", msg, "at", line, ":", col);
            document.body.innerHTML = `<div class="loading-error">
                <h2>‚ö†Ô∏è Error Loading App</h2>
                <p>${msg}</p>
                <p>Line: ${line}</p>
                <button onclick="location.reload()">Reload</button>
            </div>`;
            return false;
        };

        // Inisialisasi utama
        window.onload = async function() {
            try {
                console.log("Starting app...");
                await initApp();
                console.log("App initialized");
                switchMode('fakta');
            } catch (e) {
                console.error("Init error:", e);
                document.body.innerHTML = `<div class="loading-error">
                    <h2>‚ö†Ô∏è Failed to Initialize</h2>
                    <p>${e.message}</p>
                    <button onclick="location.reload()">Reload</button>
                </div>`;
            }
        };
    </script>
</body>
</html>
